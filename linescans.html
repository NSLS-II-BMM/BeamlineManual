

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>8. Sample position scans &#8212; BMM Beamline Manual 0.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'linescans';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="9. XAFS scans" href="xafs.html" />
    <link rel="prev" title="7. Photon Delivery System" href="pds.html" />

    <link rel="stylesheet" type="text/css" href="_static/demeter.css" />
    <link rel="stylesheet" type="text/css" href="_static/keys.css" />
    <link rel="stylesheet" type="text/css" href="_static/program.css" />
    <link rel="stylesheet" type="text/css" href="_static/color.css" />

  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/floor_mat.png" class="logo__image only-light" alt="BMM Beamline Manual 0.1 documentation - Home"/>
    <script>document.write(`<img src="_static/floor_mat.png" class="logo__image only-dark" alt="BMM Beamline Manual 0.1 documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">User documentation</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Introduction to BMM</a></li>
<li class="toctree-l1"><a class="reference internal" href="proposal.html">2. Proposal Writing for BMM</a></li>
<li class="toctree-l1"><a class="reference internal" href="before.html">3. Before your Beamtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">4. Data access</a></li>
<li class="toctree-l1"><a class="reference internal" href="instruments.html">5. Beamline instrumentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="motors.html">6. Moving and querying motors</a></li>
<li class="toctree-l1"><a class="reference internal" href="pds.html">7. Photon Delivery System</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">8. Sample position scans</a></li>
<li class="toctree-l1"><a class="reference internal" href="xafs.html">9. XAFS scans</a></li>
<li class="toctree-l1"><a class="reference internal" href="other.html">10. Other measurement needs</a></li>
<li class="toctree-l1"><a class="reference internal" href="automation.html">11. Beamline automation</a></li>
<li class="toctree-l1"><a class="reference internal" href="log.html">12. Experimental Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="manage.html">13. Managing the beamline</a></li>
<li class="toctree-l1"><a class="reference internal" href="commonchores.html">14. Common chores</a></li>
<li class="toctree-l1"><a class="reference internal" href="cheatsheet.html">15. Command cheatsheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="trouble.html">16. Troubleshooting</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Staff documentation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="desktop.html">A. BMM’s Desktop</a></li>
<li class="toctree-l1"><a class="reference internal" href="profile.html">B. An overview of BMM’s profile</a></li>
<li class="toctree-l1"><a class="reference internal" href="kafka.html">C. Kafka workers at BMM</a></li>
<li class="toctree-l1"><a class="reference internal" href="ionchambers.html">D. Ion chamber signal chains</a></li>
<li class="toctree-l1"><a class="reference internal" href="details.html">E. Instrumentation Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="restore.html">F. Power outage recovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="photos.html">G. Photo Galleries</a></li>
<li class="toctree-l1"><a class="reference internal" href="todo.html">H. To Do List</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/NSLS2/bmm-beamline-manual" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/NSLS2/bmm-beamline-manual/issues/new?title=Issue%20on%20page%20%2Flinescans.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/linescans.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Sample position scans</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#general-line-scans">8.1. General line scans</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plucking-a-point-from-a-line-scan">8.1.1. Plucking a point from a line scan</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#revisit-a-line-scan">8.1.2. Revisit a line scan</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specific-line-scans">8.2. Specific line scans</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#area-scans">8.3. Area scans</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plucking-a-point-from-an-area-scan">8.3.1. Plucking a point from an area scan</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#revisit-an-area-scan">8.3.2. Revisit an area scan</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="sample-position-scans">
<span id="linescan"></span><h1><span class="section-number">8. </span>Sample position scans<a class="headerlink" href="#sample-position-scans" title="Permalink to this heading">#</a></h1>
<section id="general-line-scans">
<h2><span class="section-number">8.1. </span>General line scans<a class="headerlink" href="#general-line-scans" title="Permalink to this heading">#</a></h2>
<p>In the nomenclature of BMM, a line scan is a simple scan of a single
motor axis with an on-screen plot.  At BMM this sort of scan is
typically done using the <code class="docutils literal notranslate"><span class="pre">linescan()</span></code> plan.  This is a wrapper
around BlueSky’s <a class="reference external" href="https://nsls-ii.github.io/bluesky/generated/bluesky.plans.rel_scan.html#bluesky.plans.rel_scan">rel_scan()</a>.</p>
<p>In BMM’s <code class="docutils literal notranslate"><span class="pre">linescan()</span></code> plan, the scan is always a relative scan
around the current position of the motor being scanned.  It works like
this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">linescan</span><span class="p">(</span><span class="n">xafs_x</span><span class="p">,</span> <span class="s1">&#39;it&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">81</span><span class="p">))</span>
</pre></div>
</div>
<p>The arguments are:</p>
<ol class="arabic simple">
<li><p>The motor axis to be scanned.  This can be either the motor’s
name in Bluesky.</p></li>
<li><p>A string indicating the detector for the plotted signal.  The
choices are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">it</span></code>: display the ratio of <code class="docutils literal notranslate"><span class="pre">It/I0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">if</span></code>: display the sum of four silicon drift channels normalized
by <code class="docutils literal notranslate"><span class="pre">I0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">i0</span></code>: display the signal on <code class="docutils literal notranslate"><span class="pre">I0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ir</span></code>: display the ratio of <code class="docutils literal notranslate"><span class="pre">Ir/It</span></code></p></li>
</ul>
</li>
<li><p>The starting position of the motor scan, relative to the current
position.</p></li>
<li><p>The ending position of the motor scan, relative to the current
position.</p></li>
<li><p>The number of steps in the scan.</p></li>
</ol>
<p>Note that the first two arguments can be in either order.  The plan
will sort it out for you.  These are equivalent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">linescan</span><span class="p">(</span><span class="s1">&#39;it&#39;</span><span class="p">,</span> <span class="n">xafs_x</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">81</span><span class="p">))</span>
<span class="n">RE</span><span class="p">(</span><span class="n">linescan</span><span class="p">(</span><span class="n">xafs_x</span><span class="p">,</span> <span class="s1">&#39;it&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">81</span><span class="p">))</span>
</pre></div>
</div>
<p>At the end of the scan, you are prompted with the following question:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Pluck motor position from the plot? yes: y the Enter (or just Enter), no: n then Enter
</pre></div>
</div>
<p>If you answer <span class="key">y</span> then <span class="key">Enter</span>, or simply hit
<span class="key">Enter</span>, you will be prompted to single click the left mouse
button <img alt="leftclick" title="Left mouse button" src="./_static/leftclick.png" hspace="3"> on the plot.</p>
<p>You will then be prompted a second time with the value you selected.</p>
<p>The motor that was scanned will then move to the motor position you
clicked on.</p>
<p>You can skip the “click for motor position” step by typing
<span class="key">n</span> and hitting <span class="key">Enter</span>.</p>
<section id="plucking-a-point-from-a-line-scan">
<span id="pluck"></span><h3><span class="section-number">8.1.1. </span>Plucking a point from a line scan<a class="headerlink" href="#plucking-a-point-from-a-line-scan" title="Permalink to this heading">#</a></h3>
<p>If you want to repeat the action of clicking on a point and moving the
motor to the click-upon point, do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">pluck</span><span class="p">())</span>
</pre></div>
</div>
<p>This will enable the left mouse <img alt="leftclick" title="Left mouse button" src="./_static/leftclick.png" hspace="3"> click and
subsequent motion on the most recent plot.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code class="docutils literal notranslate"><span class="pre">pluck()</span></code> command works on any plot made through
the <a class="reference internal" href="kafka.html#plotting"><span class="std std-numref">Kafka plotter (Section C)</span></a>.  Be sure you
are clicking on the plot you intend to pluck from!</p>
</div>
</section>
<section id="revisit-a-line-scan">
<h3><span class="section-number">8.1.2. </span>Revisit a line scan<a class="headerlink" href="#revisit-a-line-scan" title="Permalink to this heading">#</a></h3>
<div class="admonition-needs-to-be-verified admonition">
<p class="admonition-title">Needs to be verified</p>
<p>Does this still work post-data-security?</p>
</div>
<p>Retrieve data from the database using the database key or scan ID:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ls2dat</span><span class="p">(</span><span class="s1">&#39;/path/to/output.file&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;id&gt;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This writes from the database to an output file.  The output file is a
simple column data file without header or metadata.</p>
<p>The first argument is the name of the output data file.  The second
argument is either the scan’s unique ID – something like
<code class="docutils literal notranslate"><span class="pre">42447313-46a5-42ef-bf8a-46fedc2c2bd1</span></code> – or the scan’s transient
id number.</p>
</section>
</section>
<section id="specific-line-scans">
<span id="special-linescans"></span><h2><span class="section-number">8.2. </span>Specific line scans<a class="headerlink" href="#specific-line-scans" title="Permalink to this heading">#</a></h2>
<p>Some scan types are performed often enough and always with the same
arguments that they have special names.</p>
<dl>
<dt><strong>Rocking curve scan</strong></dt><dd><p>This command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">rocking_curve</span><span class="p">())</span>
</pre></div>
</div>
<p>does a scan of the pitch of the second mono crystal and plots the
signal on I0.  At the end of the scan, it moves to the position of
the peak of the rocking curve.  This scan is useful after a large
change of energy.  It also opens the slits to 3 mm in vertical size
before starting the scan, then returns the slits to their original
height after the scan.</p>
<p>You can put this scan in a macro using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">yield from</span> <span class="n">rocking_curve</span><span class="p">()</span>
</pre></div>
</div>
</dd>
<dt><strong>Slit height scan</strong></dt><dd><p>This command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">slit_height</span><span class="p">())</span>
</pre></div>
</div>
<p>Runs a scan of the DM3 BCT motor around its current position.  At
the end of the scan, you are prompted to left click
<img alt="leftclick" title="Left mouse button" src="./_static/leftclick.png" hspace="3"> on the plot to choose a position to move the
slit height to.  This scan is useful for verifying that the slits
are in the correct orientation for the delivery of beam from the
mirrors.</p>
<p>Optionally, the scan will move to the peak of the measurement,
skipping the prompt and plot interaction:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">slit_height</span><span class="p">(</span><span class="n">move</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
<p>You can put this scan in a macro using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">yield from</span> <span class="n">slit_height</span><span class="p">()</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Align ex situ sample holder</strong></p>
<blockquote>
<div><p>If the <em>ex situ</em> sample wheel is in approximately the right
position such that X-rays are passing through a slot on the outer
ring, you can center the slot around the beam with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">find_slot</span><span class="p">())</span>
</pre></div>
</div>
<p>This will run linescans in the X and Y directions, fitting a
lineshape to each scan in order to find the center position.  The
same can be done by hand by doing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">linescan</span><span class="p">(</span><span class="n">xafs_y</span><span class="p">,</span> <span class="s1">&#39;It&#39;</span><span class="p">,</span>  <span class="o">-</span><span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">31</span><span class="p">))</span>
<span class="n">RE</span><span class="p">(</span><span class="n">linescan</span><span class="p">(</span><span class="n">xafs_x</span><span class="p">,</span> <span class="s1">&#39;It&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">31</span><span class="p">))</span>
</pre></div>
</div>
<p>each time selecting the center when prompted.</p>
<p>You can put this scan in a macro using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">yield from</span> <span class="n">find_slot</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="area-scans">
<h2><span class="section-number">8.3. </span>Area scans<a class="headerlink" href="#area-scans" title="Permalink to this heading">#</a></h2>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>A raster scan type – i.e. <code class="docutils literal notranslate"><span class="pre">RE(raster())</span></code> – that does
an areascan as described here, makes a nice figure using
<a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.contourf.html">matplotlib’s contourf</a>,
exports data in formats used by popular plotting programs,
and writes a dossier was tested in 2022-2.  Current status:
dossier is written, scan works, documentation needs to be written.</p>
</div>
<p>An area scan is a simple scan of a two motor axes with an on-screen
heat map.  At BMM this sort of scan is typically done using the
<code class="docutils literal notranslate"><span class="pre">areascan()</span></code> plan.  This is a wrapper around BlueSky’s
<a class="reference external" href="https://nsls-ii.github.io/bluesky/generated/bluesky.plans.rel_grid_scan.html#bluesky.plans.rel_grid_scan">rel_grid_scan()</a>.
Because the sample stages at BMM do not have encoders, the area scan
is made by <a class="reference external" href="http://nsls-ii.github.io/bluesky/tutorial.html#scan-multiple-motors-in-a-grid">retreading the direction</a>
of the fast motor rather than snaking back and forth.</p>
<p>In BMM’s <code class="docutils literal notranslate"><span class="pre">areascan()</span></code> plan, the scan is always a relative scan
around the current positions of both motors being scanned.  It works
like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">areascan</span><span class="p">(</span><span class="s1">&#39;it&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;slow_motor&gt;&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="s1">&#39;&lt;fast_motor&gt;&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">41</span><span class="p">))</span>
</pre></div>
</div>
<p>The arguments are:</p>
<ol class="arabic">
<li><p>The slow motor axis.  This can be either the motor’s
BlueSky name or the nickname in <a class="reference internal" href="motors.html#xafs-stages"><span class="std std-numref">Table 6.1</span></a>.  So,
these are equivalent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">areascan</span><span class="p">(</span><span class="s1">&#39;it&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">41</span><span class="p">))</span>
<span class="n">RE</span><span class="p">(</span><span class="n">areascan</span><span class="p">(</span><span class="s1">&#39;it&#39;</span><span class="p">,</span> <span class="n">xafs_x</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="n">xafs_y</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">41</span><span class="p">))</span>
<span class="n">RE</span><span class="p">(</span><span class="n">areascan</span><span class="p">(</span><span class="s1">&#39;it&#39;</span><span class="p">,</span> <span class="n">xafs_x</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">41</span><span class="p">))</span>
</pre></div>
</div>
<p>For a motor that does not have a nickname, you must use the BlueSky
name, as in this very silly example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">areascan</span><span class="p">(</span><span class="s1">&#39;it&#39;</span><span class="p">,</span> <span class="n">slits3_outboard</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="n">dcm_pitch</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">41</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p>The starting position of the slow motor, relative to the current
position.</p></li>
<li><p>The ending position of the slow motor, relative to the current
position.</p></li>
<li><p>The number of steps to take on the slow motor.</p></li>
<li><p>The fast motor axis.  This can be either the motor’s
BlueSky name or the nickname in <a class="reference internal" href="motors.html#xafs-stages"><span class="std std-numref">Table 6.1</span></a>.</p></li>
<li><p>The starting position of the fast motor, relative to the current
position.</p></li>
<li><p>The ending position of the fast motor, relative to the current
position.</p></li>
<li><p>The number of steps to take on the fast motor.</p></li>
<li><p>The detector for the plotted signal.  The choices are <code class="docutils literal notranslate"><span class="pre">it</span></code>,
<code class="docutils literal notranslate"><span class="pre">if</span></code>, and <code class="docutils literal notranslate"><span class="pre">i0</span></code>.  For the <code class="docutils literal notranslate"><span class="pre">it</span></code> choice, the plot will display
the ratio of It/I0.  Similarly for the <code class="docutils literal notranslate"><span class="pre">if</span></code> choice, the plot will
display the sum of four silicon drift channels normalized by I0.
For the <code class="docutils literal notranslate"><span class="pre">i0</span></code> choice, the signal on the I0 chamber will be plotted.</p></li>
</ol>
<p>At the end of the scan, you are prompted with the following question:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Pluck motor position from the plot? [Yn]
</pre></div>
</div>
<p>If you answer <span class="key">Y</span>, or simply hit <span class="key">Return</span>, you will be
prompted to single click the left mouse button <img alt="leftclick" title="Left mouse button" src="./_static/leftclick.png" hspace="3"> on
the plot.  Both motors will then move to the position you clicked on.</p>
<p>You can skip the “click for motor position” step by typing
<span class="key">n</span> and hitting <span class="key">Return</span>.</p>
<section id="plucking-a-point-from-an-area-scan">
<h3><span class="section-number">8.3.1. </span>Plucking a point from an area scan<a class="headerlink" href="#plucking-a-point-from-an-area-scan" title="Permalink to this heading">#</a></h3>
<p>If you want to repeat the action of clicking on a point and moving the
motor to the click-upon point, do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">pluck</span><span class="p">())</span>
</pre></div>
</div>
<p>This will enable the left mouse click <img alt="leftclick" title="Left mouse button" src="./_static/leftclick.png" hspace="3"> and
subsequent motion on the most recent plot.  The <code class="docutils literal notranslate"><span class="pre">pluck()</span></code> command
<em>only</em> works on the most recent plot.  You may not pluck from an older
plot that is still displayed on the screen.</p>
<p>Of course, an older plot remains active in the sense that you can pass
the cursor over the plot and read the mouse coordinates in the bottom,
left corner of the plot window.  You can find a point in this way,
then do a movement command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">mv</span><span class="p">(</span><span class="n">xafs_x</span><span class="p">,</span> <span class="mf">28.31</span><span class="p">,</span> <span class="n">xafs_y</span><span class="p">,</span> <span class="mf">113.97</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="revisit-an-area-scan">
<h3><span class="section-number">8.3.2. </span>Revisit an area scan<a class="headerlink" href="#revisit-an-area-scan" title="Permalink to this heading">#</a></h3>
<div class="admonition-needs-to-be-verified admonition">
<p class="admonition-title">Needs to be verified</p>
<p>Does this still work post-data-security?</p>
</div>
<p>Retrieve data from the database using the database key or scan ID:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">as2dat</span><span class="p">(</span><span class="s1">&#39;/path/to/output.file&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;id&gt;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This writes from the database to an output file.  The output file is a
simple column data file.  The format of this data file is columns with
datablocks (i.e. rows of constant value of the slow motor) separated by
blank lines.  This is a format that <a class="reference external" href="http://gnuplot.sourceforge.net/docs_4.2/node331.html">works with Gnuplot</a> and other
plotting programs.</p>
<p>The first argument is the name of the output data file.  The second
argument is either the scan’s unique ID – something like
<code class="docutils literal notranslate"><span class="pre">42447313-46a5-42ef-bf8a-46fedc2c2bd1</span></code> – or the scan’s transient
id number.</p>

<br>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="pds.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">7. </span>Photon Delivery System</p>
      </div>
    </a>
    <a class="right-next"
       href="xafs.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">9. </span>XAFS scans</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#general-line-scans">8.1. General line scans</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plucking-a-point-from-a-line-scan">8.1.1. Plucking a point from a line scan</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#revisit-a-line-scan">8.1.2. Revisit a line scan</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specific-line-scans">8.2. Specific line scans</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#area-scans">8.3. Area scans</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plucking-a-point-from-an-area-scan">8.3.1. Plucking a point from an area scan</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#revisit-an-area-scan">8.3.2. Revisit an area scan</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Bruce Ravel
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>